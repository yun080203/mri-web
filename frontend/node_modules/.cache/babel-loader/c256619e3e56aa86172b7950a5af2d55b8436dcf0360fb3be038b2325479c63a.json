{"ast":null,"code":"var _jsxFileName = \"D:\\\\GitHub\\\\mri-web-app\\\\frontend\\\\src\\\\components\\\\Viewer\\\\DICOMViewer.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport * as cornerstone from 'cornerstone-core';\nimport * as cornerstoneWADOImageLoader from 'cornerstone-web-image-loader';\nimport * as dicomParser from 'dicom-parser';\n\n// 配置DICOM解析器\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\ncornerstoneWADOImageLoader.configure({\n  webWorkerPath: '/cornerstone/cornerstoneWADOImageLoaderWebWorker.js',\n  taskConfiguration: {\n    'decodeTask': {\n      codecsPath: '/cornerstone/cornerstoneWADOImageLoaderCodecs.js'\n    }\n  }\n});\nexport default function DICOMViewer({\n  imageUrl\n}) {\n  _s();\n  const canvasRef = useRef(null);\n  useEffect(() => {\n    const loadImage = async () => {\n      try {\n        // 注册DICOM图像ID\n        const imageId = `wadouri:${imageUrl}`;\n\n        // 加载图像\n        const image = await cornerstone.loadImage(imageId);\n\n        // 获取画布元素\n        const canvas = canvasRef.current;\n        const element = canvas.parentElement;\n\n        // 启用画布交互\n        cornerstone.enable(element);\n\n        // 显示图像\n        cornerstone.displayImage(element, image);\n\n        // 调整视窗\n        cornerstone.fitToWindow(element);\n\n        // 初始化工具\n        cornerstoneTools.init({\n          globalToolSyncEnabled: true\n        });\n\n        // 添加基础工具\n        cornerstoneTools.addTool(cornerstoneTools.WwwcTool);\n        cornerstoneTools.setToolActive('Wwwc', {\n          mouseButtonMask: 1\n        });\n      } catch (err) {\n        console.error('DICOM加载失败:', err);\n      }\n    };\n    loadImage();\n    return () => {\n      // 清理资源\n      if (canvasRef.current) {\n        cornerstone.disable(canvasRef.current.parentElement);\n      }\n    };\n  }, [imageUrl]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      width: '800px',\n      height: '600px',\n      position: 'relative'\n    },\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '100%',\n        height: '100%'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n}\n_s(DICOMViewer, \"UJgi7ynoup7eqypjnwyX/s32POg=\");\n_c = DICOMViewer;\nvar _c;\n$RefreshReg$(_c, \"DICOMViewer\");","map":{"version":3,"names":["React","useEffect","useRef","cornerstone","cornerstoneWADOImageLoader","dicomParser","jsxDEV","_jsxDEV","external","configure","webWorkerPath","taskConfiguration","codecsPath","DICOMViewer","imageUrl","_s","canvasRef","loadImage","imageId","image","canvas","current","element","parentElement","enable","displayImage","fitToWindow","cornerstoneTools","init","globalToolSyncEnabled","addTool","WwwcTool","setToolActive","mouseButtonMask","err","console","error","disable","style","width","height","position","children","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/GitHub/mri-web-app/frontend/src/components/Viewer/DICOMViewer.js"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport * as cornerstone from 'cornerstone-core';\r\nimport * as cornerstoneWADOImageLoader from 'cornerstone-web-image-loader';\r\nimport * as dicomParser from 'dicom-parser';\r\n\r\n// 配置DICOM解析器\r\ncornerstoneWADOImageLoader.external.cornerstone = cornerstone;\r\ncornerstoneWADOImageLoader.external.dicomParser = dicomParser;\r\ncornerstoneWADOImageLoader.configure({\r\n    webWorkerPath: '/cornerstone/cornerstoneWADOImageLoaderWebWorker.js',\r\n  taskConfiguration: {\r\n    'decodeTask': {\r\n      codecsPath: '/cornerstone/cornerstoneWADOImageLoaderCodecs.js'\r\n    }\r\n  }\r\n});\r\n\r\nexport default function DICOMViewer({ imageUrl }) {\r\n  const canvasRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const loadImage = async () => {\r\n      try {\r\n        // 注册DICOM图像ID\r\n        const imageId = `wadouri:${imageUrl}`;\r\n        \r\n        // 加载图像\r\n        const image = await cornerstone.loadImage(imageId);\r\n        \r\n        // 获取画布元素\r\n        const canvas = canvasRef.current;\r\n        const element = canvas.parentElement;\r\n        \r\n        // 启用画布交互\r\n        cornerstone.enable(element);\r\n        \r\n        // 显示图像\r\n        cornerstone.displayImage(element, image);\r\n        \r\n        // 调整视窗\r\n        cornerstone.fitToWindow(element);\r\n        \r\n        // 初始化工具\r\n        cornerstoneTools.init({\r\n          globalToolSyncEnabled: true\r\n        });\r\n        \r\n        // 添加基础工具\r\n        cornerstoneTools.addTool(cornerstoneTools.WwwcTool);\r\n        cornerstoneTools.setToolActive('Wwwc', { mouseButtonMask: 1 });\r\n      } catch (err) {\r\n        console.error('DICOM加载失败:', err);\r\n      }\r\n    };\r\n\r\n    loadImage();\r\n\r\n    return () => {\r\n      // 清理资源\r\n      if (canvasRef.current) {\r\n        cornerstone.disable(canvasRef.current.parentElement);\r\n      }\r\n    };\r\n  }, [imageUrl]);\r\n\r\n  return (\r\n    <div style={{ width: '800px', height: '600px', position: 'relative' }}>\r\n      <div style={{ width: '100%', height: '100%' }}>\r\n        <canvas ref={canvasRef} />\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAChD,OAAO,KAAKC,WAAW,MAAM,kBAAkB;AAC/C,OAAO,KAAKC,0BAA0B,MAAM,8BAA8B;AAC1E,OAAO,KAAKC,WAAW,MAAM,cAAc;;AAE3C;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACAH,0BAA0B,CAACI,QAAQ,CAACL,WAAW,GAAGA,WAAW;AAC7DC,0BAA0B,CAACI,QAAQ,CAACH,WAAW,GAAGA,WAAW;AAC7DD,0BAA0B,CAACK,SAAS,CAAC;EACjCC,aAAa,EAAE,qDAAqD;EACtEC,iBAAiB,EAAE;IACjB,YAAY,EAAE;MACZC,UAAU,EAAE;IACd;EACF;AACF,CAAC,CAAC;AAEF,eAAe,SAASC,WAAWA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EAChD,MAAMC,SAAS,GAAGd,MAAM,CAAC,IAAI,CAAC;EAE9BD,SAAS,CAAC,MAAM;IACd,MAAMgB,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAI;QACF;QACA,MAAMC,OAAO,GAAG,WAAWJ,QAAQ,EAAE;;QAErC;QACA,MAAMK,KAAK,GAAG,MAAMhB,WAAW,CAACc,SAAS,CAACC,OAAO,CAAC;;QAElD;QACA,MAAME,MAAM,GAAGJ,SAAS,CAACK,OAAO;QAChC,MAAMC,OAAO,GAAGF,MAAM,CAACG,aAAa;;QAEpC;QACApB,WAAW,CAACqB,MAAM,CAACF,OAAO,CAAC;;QAE3B;QACAnB,WAAW,CAACsB,YAAY,CAACH,OAAO,EAAEH,KAAK,CAAC;;QAExC;QACAhB,WAAW,CAACuB,WAAW,CAACJ,OAAO,CAAC;;QAEhC;QACAK,gBAAgB,CAACC,IAAI,CAAC;UACpBC,qBAAqB,EAAE;QACzB,CAAC,CAAC;;QAEF;QACAF,gBAAgB,CAACG,OAAO,CAACH,gBAAgB,CAACI,QAAQ,CAAC;QACnDJ,gBAAgB,CAACK,aAAa,CAAC,MAAM,EAAE;UAAEC,eAAe,EAAE;QAAE,CAAC,CAAC;MAChE,CAAC,CAAC,OAAOC,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,YAAY,EAAEF,GAAG,CAAC;MAClC;IACF,CAAC;IAEDjB,SAAS,CAAC,CAAC;IAEX,OAAO,MAAM;MACX;MACA,IAAID,SAAS,CAACK,OAAO,EAAE;QACrBlB,WAAW,CAACkC,OAAO,CAACrB,SAAS,CAACK,OAAO,CAACE,aAAa,CAAC;MACtD;IACF,CAAC;EACH,CAAC,EAAE,CAACT,QAAQ,CAAC,CAAC;EAEd,oBACEP,OAAA;IAAK+B,KAAK,EAAE;MAAEC,KAAK,EAAE,OAAO;MAAEC,MAAM,EAAE,OAAO;MAAEC,QAAQ,EAAE;IAAW,CAAE;IAAAC,QAAA,eACpEnC,OAAA;MAAK+B,KAAK,EAAE;QAAEC,KAAK,EAAE,MAAM;QAAEC,MAAM,EAAE;MAAO,CAAE;MAAAE,QAAA,eAC5CnC,OAAA;QAAQoC,GAAG,EAAE3B;MAAU;QAAA4B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACvB;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAAChC,EAAA,CAvDuBF,WAAW;AAAAmC,EAAA,GAAXnC,WAAW;AAAA,IAAAmC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}